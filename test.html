<!DOCTYPE html>
<html>

<script id="vertex-shader" type="x-shader/x-vertex">

attribute vec4 vPosition;
attribute vec3 vNormal;
attribute vec2 vTexCoord;

uniform mat4 modelViewMatrix;
uniform mat4 cameraMatrix;
uniform mat4 projectionMatrix;
uniform mat3 normalMatrix;

varying vec3 fPos;
varying vec3 fNormal;
varying vec2 fTexCoord;

void main ()
{

    fPos = (modelViewMatrix * vPosition).xyz;
    fNormal = (normalMatrix * vNormal);
    fTexCoord = vTexCoord;

    gl_Position = projectionMatrix * cameraMatrix * modelViewMatrix * vPosition;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">

precision mediump float;

uniform int fLightCount;
uniform sampler2D texture;

varying vec3 fPos;
varying vec3 fNormal;
varying vec2 fTexCoord;

uniform vec4 fAmbientMaterial, fDiffuseMaterial, fSpecularMaterial;
uniform float fShininess;
uniform vec4 fLightPosition[2];
uniform vec4 fAmbientLight[2], fDiffuseLight[2], fSpecularLight[2];
uniform vec3 fCameraPosition;

void main ()
{
    vec4 fColor = vec4 (0.0, 0.0, 0.0, 1.0);

    for (int i = 0; i < 2; i++) {
        vec3 L;
        if (fLightPosition[i].w == 0.0) 
            L = normalize (fLightPosition[i].xyz);
        else 
            L = normalize (fLightPosition[i].xyz - fPos);

        vec3 E = normalize (fCameraPosition - fPos);

        vec3 N = normalize (fNormal);

        vec3 H = normalize (L + E);

        // ambient
        vec4 ambient = fAmbientMaterial * fAmbientLight[i];

        //diffuse
        float Kd = max (dot (L, N), 0.0);
        vec4 diffuse = Kd * fDiffuseMaterial * fDiffuseLight[i];

        // specular
        float Ks = pow (max (dot (N, H), 0.0), fShininess);
        vec4 specular = Ks * fSpecularMaterial * fSpecularLight[i];
    
        if (dot (L, N) < 0.0)
            specular = vec4 (0.0, 0.0, 0.0, 1.0);

        vec4 fLighting = (ambient + diffuse + specular);
        fColor = fColor + fLighting;
        fColor.a = 1.0;
    }

    gl_FragColor = fColor * texture2D (texture, fTexCoord);;
}

</script>

<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript" src="initShaders.js"></script>
<script type="text/javascript" src="gl-matrix.js"></script>
<script type="text/javascript" src="test.js"></script>
<script type="text/javascript" src="quaternion.js"></script>
<script type="text/javascript" src="sceneGraph.js"></script>

<script type="text/plain" id="testCubeOBJ"> 
# Blender v2.78 (sub 0) OBJ File: 'testcube.blend'
# www.blender.org
mtllib testcube.mtl
o Cube
v 1.000000 -1.000000 -1.000000
v 1.000000 -1.000000 1.000000
v -1.000000 -1.000000 1.000000
v -1.000000 -1.000000 -1.000000
v 1.000000 1.000000 -0.999999
v 0.999999 1.000000 1.000001
v -1.000000 1.000000 1.000000
v -1.000000 1.000000 -1.000000
vt 0.0138 0.6804
vt 0.3196 0.6804
vt 0.3196 0.9862
vt 0.0138 0.9862
vt 0.6529 0.3471
vt 0.6529 0.6529
vt 0.3471 0.6529
vt 0.3471 0.3471
vt 0.6529 0.3196
vt 0.3471 0.3196
vt 0.3471 0.0138
vt 0.6529 0.0138
vt 0.0138 0.3196
vt 0.0138 0.0138
vt 0.3196 0.0138
vt 0.3196 0.3196
vt 0.9862 0.3196
vt 0.6804 0.3196
vt 0.6804 0.0138
vt 0.9862 0.0138
vt 0.0138 0.3471
vt 0.3196 0.3471
vt 0.3196 0.6529
vt 0.0138 0.6529
vn 0.0000 -1.0000 0.0000
vn 0.0000 1.0000 0.0000
vn 1.0000 0.0000 0.0000
vn -0.0000 -0.0000 1.0000
vn -1.0000 -0.0000 -0.0000
vn 0.0000 0.0000 -1.0000
usemtl testcube_material
s off
f 1/1/1 2/2/1 3/3/1 4/4/1
f 5/5/2 8/6/2 7/7/2 6/8/2
f 1/9/3 5/10/3 6/11/3 2/12/3
f 2/13/4 6/14/4 7/15/4 3/16/4
f 3/17/5 7/18/5 8/19/5 4/20/5
f 5/21/6 1/22/6 4/23/6 8/24/6
</script>

<script type="text/plain" id="testCubeMAT"> 
# Blender MTL File: 'testcube.blend'
# Material Count: 1

newmtl testcube_material
Ns 40.00
Ka 0.600000 0.600000 0.600000
Kd 0.600000 0.600000 0.600000
Ks 0.600000 0.600000 0.600000
Ke 0.000000 0.000000 0.000000
Ni 1.000000
d 1.000000
illum 2

</script>

<img id= "testCubeTEX" src="Meshes/testcube_color.png" hidden></img>
<img id = "TEXfrance" src="France.png" hidden></img>

<body>
<canvas id="gl-canvas" width="960" height="540">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
</body>
</html>
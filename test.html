<!DOCTYPE html>
<html>

<script id="vertex-shader" type="x-shader/x-vertex">

attribute vec4 vPosition;
attribute vec3 vNormal;

uniform mat4 modelViewMatrix;
uniform mat4 cameraMatrix;
uniform mat4 projectionMatrix;
uniform mat3 normalMatrix;

varying vec3 fPos;
varying vec3 fNormal;

void main ()
{

    fPos = (modelViewMatrix * vPosition).xyz;
    fNormal = (normalMatrix * vNormal);

    gl_Position = projectionMatrix * cameraMatrix * modelViewMatrix * vPosition;
}
</script>

<script id="fragment-shader" type="x-shader/x-fragment">

precision mediump float;

uniform int fLightCount;

varying vec3 fPos;
varying vec3 fNormal;

uniform vec4 fAmbientMaterial, fDiffuseMaterial, fSpecularMaterial;
uniform float fShininess;
uniform vec4 fLightPosition[2];
uniform vec4 fAmbientLight[2], fDiffuseLight[2], fSpecularLight[2];
uniform vec3 fCameraPosition;

void main ()
{
    vec4 fColor = vec4 (0.0, 0.0, 0.0, 1.0);

    for (int i = 0; i < 2; i++) {
        vec3 L;
        if (fLightPosition[i].w == 0.0) 
            L = normalize (fLightPosition[i].xyz);
        else 
            L = normalize (fLightPosition[i].xyz - fPos);

        vec3 E = normalize (fCameraPosition - fPos);

        vec3 N = normalize (fNormal);

        vec3 H = normalize (L + E);

        // ambient
        vec4 ambient = fAmbientMaterial * fAmbientLight[i];

        //diffuse
        float Kd = max (dot (L, N), 0.0);
        vec4 diffuse = Kd * fDiffuseMaterial * fDiffuseLight[i];

        // specular
        float Ks = pow (max (dot (N, H), 0.0), fShininess);
        vec4 specular = Ks * fSpecularMaterial * fSpecularLight[i];
    
        if (dot (L, N) < 0.0)
            specular = vec4 (0.0, 0.0, 0.0, 1.0);

        vec4 fLighting = (ambient + diffuse + specular);
        fColor = fColor + fLighting;
        fColor.a = 1.0;
    }

    gl_FragColor = fColor;
}

</script>

<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript" src="initShaders.js"></script>
<script type="text/javascript" src="gl-matrix.js"></script>
<script type="text/javascript" src="test.js"></script>
<script type="text/javascript" src="quaternion.js"></script>
<script type="text/javascript" src="sceneGraphs.js"></script>


<body>
<canvas id="gl-canvas" width="960" height="540">
Oops ... your browser doesn't support the HTML5 canvas element
</canvas>
</body>
</html>